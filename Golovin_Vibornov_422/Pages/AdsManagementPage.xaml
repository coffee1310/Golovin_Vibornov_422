<Page x:Class="Golovin_Vibornov_422.Pages.AdsManagementPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Golovin_Vibornov_422.Pages"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="AdsManagementPage">

    <Grid Background="White">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Шапка с навигацией и информацией о пользователе -->
        <Border Grid.Row="0" Background="#0078D4" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Кнопка назад -->
                <Button Grid.Column="0" Content="← Назад" Click="BackButton_Click" 
                        ToolTip="Вернуться на предыдущую страницу"/>

                <!-- Заголовок страницы -->
                <TextBlock Grid.Column="1" Text="Управление объявлениями" 
                          FontSize="20" FontWeight="Bold" Foreground="White"
                          HorizontalAlignment="Center" VerticalAlignment="Center"/>

                <!-- Информация о пользователе и кнопка выхода -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock x:Name="lblUserInfo" Foreground="White" FontSize="12" 
                              Margin="0,0,15,0" VerticalAlignment="Center"
                              ToolTip="Текущий пользователь системы"/>
                    <Button Content="Выйти" Click="LogoutButton_Click" 
                            ToolTip="Выйти из системы"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Панель инструментов -->
        <Border Grid.Row="0" Background="White" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1"
                Margin="0,65,0,0" Padding="15,10">
            <StackPanel Orientation="Horizontal">
                <Button Content="➕ Добавить объявление" Click="AddButton_Click" 
                        ToolTip="Создать новое объявление"/>
                <Button Content="🔄 Обновить список" Click="RefreshButton_Click" 
                        ToolTip="Обновить данные объявлений" Margin="10,0,0,0"/>
            </StackPanel>
        </Border>

        <!-- Сетка с объявлениями -->
        <Border Grid.Row="1" Margin="15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Статус загрузки -->
                <Border x:Name="loadingPanel" Grid.Row="0" Background="#FFF4CE" 
                       BorderBrush="#FFD965" BorderThickness="1" Padding="10" 
                       CornerRadius="4" Margin="0,0,0,10" Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="⏳" FontSize="14" Margin="0,0,8,0"/>
                        <TextBlock x:Name="lblLoading" Text="Загрузка данных..." 
                                  FontSize="12" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Таблица объявлений -->
                <DataGrid Grid.Row="1" x:Name="dgAds" AutoGenerateColumns="False" 
          IsReadOnly="True" SelectionMode="Single"
          BorderThickness="1" BorderBrush="#E0E0E0"
          HeadersVisibility="Column" RowHeight="35" 
          FontSize="12" SelectionChanged="dgAds_SelectionChanged"
          MouseDoubleClick="dgAds_MouseDoubleClick"
          ToolTip="Дважды щелкните для редактирования объявления">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding id}" Width="50"/>
                        <DataGridTextColumn Header="Заголовок" Binding="{Binding ad_title}" Width="200"/>
                        <DataGridTextColumn Header="Описание" Binding="{Binding ad_description}" Width="250"/>
                        <DataGridTextColumn Header="Дата" Binding="{Binding ad_post_date, StringFormat=dd.MM.yyyy}" Width="90"/>
                        <DataGridTextColumn Header="Город" Binding="{Binding City.city1}" Width="100"/>
                        <DataGridTextColumn Header="Категория" Binding="{Binding Category.name}" Width="110"/>
                        <DataGridTextColumn Header="Тип" Binding="{Binding AdType.type}" Width="90"/>
                        <DataGridTextColumn Header="Статус" Binding="{Binding AdStatus.status}" Width="90">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding AdStatus.status}" Value="Активно">
                                            <Setter Property="Foreground" Value="Green"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding AdStatus.status}" Value="Завершено">
                                            <Setter Property="Foreground" Value="Gray"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Цена" Binding="{Binding price, StringFormat=C}" Width="90"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Сообщение при отсутствии данных -->
                <Border x:Name="emptyStatePanel" Grid.Row="1" Background="#F9F9F9" 
                       Visibility="Collapsed" HorizontalAlignment="Center" 
                       VerticalAlignment="Center" Padding="30">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="📝" FontSize="48" HorizontalAlignment="Center" 
                                  Margin="0,0,0,15"/>
                        <TextBlock Text="У вас пока нет объявлений" FontSize="16" 
                                  FontWeight="SemiBold" HorizontalAlignment="Center"
                                  Margin="0,0,0,5"/>
                        <TextBlock Text="Создайте первое объявление, нажав на кнопку 'Добавить объявление'" 
                                  FontSize="12" Foreground="#666666" 
                                  TextAlignment="Center" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Статус бар -->
        <StatusBar Grid.Row="2" Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
            <StatusBarItem>
                <TextBlock x:Name="lblStatus" Text="Готово" FontSize="11" Foreground="#333333"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="lblCount" Text="Объявлений: 0" FontSize="11" Foreground="#666666"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Page>